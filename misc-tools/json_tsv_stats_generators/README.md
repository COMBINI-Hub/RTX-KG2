# JSON and TSV Stats Generators

## Description

Two Python scripts (`get_stats_json.py` and `get_stats_tsv.py`) were written
in support of a project that aimed to compare KG2 with KG2c in terms of
various graph statistics including vertex count, edge count, diameter, average
all-pairs-shortest-paths distance, and degree distribution. The scripts use
the `python-igraph` library and perform the following tasks:

1. Parse one JSON or two TSV source files holding edge and node data
2. Use the edge data to build a graph
3. Generate graph stats and a log-log plot of the degree distribution
4. Create a JSON report file containing the generated stats and metadata

## Requirements

The scripts were run on an Amazon EC2 instance (Ubuntu 18.04.5 LTS) with
Python 3.7.5. To install the Python packages, run:

```
$ pip install -r requirements.txt
```

## Scripts

### get_stats_json.py

This script was used for KG2.4.0 and can potentially be used for
other versions of KG2 that involve one JSON source file containing
edge and node data.

Usage:

```python
python3 get_stats_json.py <input_file> <output_file_location>
```
where `input_file` is the path to the JSON source file and
`output_file_location` is the path to the directory in which
the JSON report file is to be created.

Example usage:

```python
python3 get_stats_json.py /some_dir_1/some_dir_2/kg2-slim.json ./
```

### get_stats_tsv.py

This script was used for KG2c.4.0 and can potentially be used for other
versions of KG2c that involve two TSV source files, one containing edge data
and the other containing node data. For KG2c versions that involve one JSON
source file, consider using `get_stats_json.py`.

Usage:

```python
python3 get_stats_tsv.py <tsv_edge_input_file> <tsv_node_input_file> <output_file_location>
```

where `tsv_edge_input_file` is the path to the TSV source file containing
edge data, `tsv_node_input_file` is the path to the TSV source file
containing node data, and `output_file_location` is the path to the
directory in which the JSON report file is to be created.

Example usage:

```python
python3 get_stats_tsv.py /some_dir/edges_c.tsv /some_dir/nodes_c.tsv ./
```

### Script Runtime

Factors that affect the total runtime of each script include:

* Presence/absence of a pickled graph (i.e., `kg2.pickle` or `kg2c.pickle`)
  in the same directory as the script
  * If a pickled graph already exists, the script simply reads and returns it.
  * If a pickled graph does not exist, the script builds a graph using the
    source file and creates a pickled file in the same directory as the
    script. This process takes more time than the one above.

* Sample size (i.e., number of nodes) used to estimate the average all-pairs
  shortest paths distance and the diameter
  * The sample size can be directly modified in each script by changing the
    value of the variable `num_nodes_in_sample` in the function
    `calculate_graph_stats`.
  * Example runtimes<sup>*</sup> for reference:

    * KG2
      Sample size | Script runtime
      ----------- | -------
      40 | 20 min, 7 s
      1141 | 4 h, 26 min, 31 s
      |

    * KG2c
      Sample size | Script runtime
      ----------- | -------
      140 | 20 min, 42 s
      1141 | 2 h, 19 min, 50 s
      |

  * For these runtimes, a pickled graph was not used.

## Sample Files
Sample JSON report files and log-log plots are provided in `sample_reports/`
and `sample_plots/`, respectively.

* The provided sample files were generated by the scripts (or previous
  versions thereof). For clarity, the names of the provided report files have
  been manually appended with the sample size used
  (e.g., "stats_report_json_**1141_nodes**.json").

* In the `runtimes` section of a given JSON report file, the values for
  the keys `build_graph`, `calculate_graph_stats` and `execute_complete_script`
  have the format `hours:minutes:seconds:deciseconds`. The values for the keys
  `estimate_average_all_pairs_shortest_paths_distance_in_sample_for_directed_graph`
  and `estimate_average_all_pairs_shortest_paths_distance_in_sample_for_undirected_graph`
  are in seconds.

## Authors and Acknowledgment
* The scripts were written by Timothy Yoon.
* Sincere thanks to Stephen Ramsey and Amy Glen for their valuable guidance
  and feedback throughout the course of this project.
* This work was supported in part by Semiconductor Research Corporation,
  with sponsorship from Intel Corporation.
